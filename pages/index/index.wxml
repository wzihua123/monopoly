<view class="container">
  <!-- æ¸¸æˆä¿¡æ¯ -->
  <view class="game-info">
    <view class="level-info" bindtap="showLevelInfo">
      <view class="level-title">{{levelTitles[player.level-1]}}</view>
      <view class="level-number">Lv.{{player.level}}</view>
      <view class="exp-bar-container">
        <view class="exp-bar">
          <view class="exp-progress" 
                style="width: {{getExpPercentage()}}%">
          </view>
        </view>
      </view>
      <view class="level-desc">{{levelDescriptions[player.level]}}</view>
      <view class="level-tip">ç‚¹å‡»æŸ¥çœ‹ç­‰çº§è¯¦æƒ…</view>
    </view>
    <view class="player-stats">
      <view class="stat-item">
        <view class="stat-icon">ğŸ’°</view>
        <view class="stat-value">{{player.money}}</view>
      </view>
      <view class="stat-item">
        <view class="stat-icon">â­</view>
        <view class="stat-value">{{player.score}}/{{targetScore}}</view>
      </view>
      <view class="stat-item">
        <view class="stat-icon">ğŸ†</view>
        <view class="stat-value">{{player.achievements.length}}</view>
      </view>
    </view>
  </view>

  <!-- éª°å­åŒºåŸŸ -->
  <view class="dice-section">
    <view class="dice-wrapper">
      <view class="dice {{diceAnimating ? 'dice-animate' : ''}}" 
            style="transform: rotate({{diceRotation}}deg)">
        <text class="dice-face">{{diceFaces[diceNumber]}}</text>
      </view>
      <view class="dice-shadow {{diceAnimating ? 'shadow-animate' : ''}}"></view>
    </view>
    <button class="roll-button {{diceAnimating ? 'button-disabled' : ''}}" 
            bindtap="rollDice" 
            disabled="{{gameOver || diceAnimating}}">
      {{diceAnimating ? 'éª°å­ç¿»æ»šä¸­...' : 'æ·éª°å­'}}
    </button>
  </view>

  <!-- å¥–åŠ±æç¤º -->
  <view class="reward-popup {{showReward ? 'show-reward' : ''}}">
    {{rewardText}}
  </view>

  <!-- æ¸¸æˆåœ°å›¾ -->
  <view class="game-map">
    <view wx:for="{{mapCells}}" 
          wx:key="id" 
          class="map-cell {{player.position === index ? 'current' : ''}}">
      <view class="cell-icon">{{item.icon}}</view>
      <view class="cell-content">
        <text class="cell-name">{{item.name}}</text>
        <text class="cell-desc">{{item.description}}</text>
      </view>
    </view>
  </view>
</view>

<!-- æ¸¸æˆè§„åˆ™è¯´æ˜ -->
<view class="action-buttons">
  <view class="rules-button" bindtap="showRules">
    <text class="rules-icon">â“</text>
  </view>
  <view class="achievement-button" bindtap="showAchievements">
    <text class="achievement-icon">ğŸ†</text>
  </view>
</view>

<!-- åœ¨æœ€åæ·»åŠ æµ‹è¯•é¢æ¿ -->
<view class="debug-panel" wx:if="{{debugMode}}">
  <view class="debug-title">æµ‹è¯•é¢æ¿</view>
  
  <view class="debug-section">
    <text>éª°å­ç‚¹æ•° (1-6):</text>
    <input type="number" 
           value="{{testDiceNumber}}"
           bindinput="setTestDiceNumber"
           class="debug-input"/>
  </view>

  <view class="debug-section">
    <text>å¿«é€Ÿè®¾ç½®:</text>
    <view class="debug-buttons">
      <button size="mini" 
              data-attribute="money" 
              data-value="10000" 
              bindtap="setPlayerAttribute">é‡‘å¸+10000</button>
      <button size="mini" 
              data-attribute="score" 
              data-value="500" 
              bindtap="setPlayerAttribute">åˆ†æ•°+500</button>
      <button size="mini" 
              data-attribute="exp" 
              data-value="1000" 
              bindtap="setPlayerAttribute">ç»éªŒ+1000</button>
    </view>
  </view>

  <view class="debug-info">
    <text>å½“å‰çŠ¶æ€:</text>
    <text>é‡‘å¸: {{player.money}}</text>
    <text>åˆ†æ•°: {{player.score}}</text>
    <text>ç­‰çº§: {{player.level}}</text>
    <text>ç»éªŒ: {{player.exp}}</text>
  </view>
</view>

<!-- åªåœ¨å¼€å‘ç¯å¢ƒæ˜¾ç¤ºæµ‹è¯•æ¨¡å¼å¼€å…³æŒ‰é’® -->
<view class="debug-toggle" bindtap="toggleDebugMode" wx:if="{{env === 'dev'}}">
  <text>{{debugMode ? 'å…³é—­æµ‹è¯•' : 'å¼€å¯æµ‹è¯•'}}</text>
</view>

<view class="target-setup-modal" wx:if="{{showTargetSetup}}">
  <view class="target-setup">
    <view class="target-header">
      <text>è®¾ç½®æ¸¸æˆç›®æ ‡ (æ€»åˆ†ï¼š{{gameTarget.totalTarget}})</text>
      <text class="remaining">å‰©ä½™ï¼š{{getRemainingTarget()}}</text>
    </view>
    
    <view class="target-items">
      <view class="target-item">
        <text>ğŸ’° é‡‘é’±å€¼</text>
        <view class="target-controls">
          <text class="btn-adjust" bindtap="adjustTarget" data-type="money" data-action="minus">-</text>
          <input type="number" value="{{targetSetup.moneyTarget}}" bindinput="onTargetInput" data-type="money"/>
          <text class="btn-adjust" bindtap="adjustTarget" data-type="money" data-action="plus">+</text>
        </view>
      </view>

      <view class="target-item">
        <text>ğŸ˜Š å¹¸ç¦å€¼</text>
        <view class="target-controls">
          <text class="btn-adjust" bindtap="adjustTarget" data-type="happy" data-action="minus">-</text>
          <input type="number" value="{{targetSetup.happyTarget}}" bindinput="onTargetInput" data-type="happy"/>
          <text class="btn-adjust" bindtap="adjustTarget" data-type="happy" data-action="plus">+</text>
        </view>
      </view>

      <view class="target-item">
        <text>ğŸ… åèª‰å€¼</text>
        <view class="target-controls">
          <text class="btn-adjust" bindtap="adjustTarget" data-type="honor" data-action="minus">-</text>
          <input type="number" value="{{targetSetup.honorTarget}}" bindinput="onTargetInput" data-type="honor"/>
          <text class="btn-adjust" bindtap="adjustTarget" data-type="honor" data-action="plus">+</text>
        </view>
      </view>
    </view>

    <button class="btn-confirm" bindtap="confirmTargets" disabled="{{getRemainingTarget() > 0}}">
      å¼€å§‹æ¸¸æˆ
    </button>
  </view>
</view>

<!-- ä¿®æ”¹æŠ½å¥–æ¨¡æ€æ¡† -->
<view class="lottery-modal" wx:if="{{lottery.showLottery}}">
  <view class="lottery-box">
    <view class="lottery-title">æŠ½å–èµ·å§‹èµ„é‡‘</view>
    <view class="lottery-items">
      <view class="lottery-item {{lottery.selectedIndex === index ? 'selected' : ''}}" 
            wx:for="{{lottery.rewards}}" 
            wx:key="value">
        <text>{{item.text}}</text>
      </view>
    </view>
    <button class="lottery-btn {{lottery.isSpinning ? 'spinning' : ''}}" 
            bindtap="startLottery" 
            disabled="{{lottery.isSpinning}}">
      {{lottery.isSpinning ? 'æŠ½å¥–ä¸­...' : 'ç‚¹å‡»æŠ½å¥–'}}
    </button>
  </view>
</view>

